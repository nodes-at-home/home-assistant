###
### 22.08.2019 split up
###

  - state_topic: nodes@home/meter/electricity/utilityroom/value/tick
    name: "electricity@utilityroom_power"
    qos: 0
    unit_of_measurement: "W"
    value_template: "{{ ( 1000 / states ( 'input_number.electricity_meter_revolutions_per_kwh' ) | int * 3600 / value_json.dt | float ) | int }}"

  - state_topic: nodes@home/meter/electricity/utilityroom/value/tick
    name: "electricity@utilityroom_meter"
    qos: 0
    unit_of_measurement: "kWh"
    value_template: "{{ (( 1000 / states ( 'input_number.electricity_meter_revolutions_per_kwh' ) | int ) / 1000 ) | round ( 4 ) }}"
    force_update: true

  - state_topic: nodes@home/meter/electricity/utilityroom/value/tick
    name: "electricity@utilityroom_dt"
    qos: 0
    unit_of_measurement: "s"
    value_template: "{{ value_json.dt | round ( 1 ) }}"
    force_update: true

  - state_topic: nodes@home/meter/electricity/utilityroom/value/tick
    name: "electricity@utilityroom_threshold_voltage"
    qos: 0
    unit_of_measurement: "mV"
    value_template: "{{ value_json.threshold | int }}"
    force_update: true

  - state_topic: nodes@home/meter/electricity/utilityroom/value/tick
    name: "electricity@utilityroom_threshold_latency"
    qos: 0
    value_template: "{{ value_json.latency | int }}"
    force_update: true

  - state_topic: nodes@home/meter/electricity/utilityroom
    name: "electricity@utilityroom_version"
    qos: 0
    value_template: '{{ value }}'

  - state_topic: nodes@home/meter/electricity/utilityroom
    name: "electricity@utilityroom_lastboot"
    qos: 0
    value_template: '{{ as_timestamp ( now () ) | timestamp_custom ( "%d.%m.%Y %H:%M:%S", true ) }}'

  - state_topic: nodes@home/meter/electricity/utilityroom/value/voltage
    name: "electricity@utilityroom_voltage"
    qos: 0
    unit_of_measurement: "V"
    value_template: '{{ value_json.value | multiply  ( 0.001 ) | round ( 1 ) }}'

  - state_topic: nodes@home/meter/electricity/utilityroom/value/voltage
    name: "electricity@utilityroom_lastvoltage"
    qos: 0
    value_template: '{{ as_timestamp ( now () ) | timestamp_custom ( "%d.%m.%Y %H:%M:%S", true ) }}'
