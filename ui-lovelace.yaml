#
# lovelace configuration
#

title: !env_var HA_TITLE
views:

  - title: Überblick
    path: home
    panel: false
    badges:
      - type: entity-filter
        entities:
          - entity: person.gast
            display_type: complete
            show_entity_picture: true
          - entity: person.andreas
            display_type: complete
            show_entity_picture: true
          - entity: person.undine
            display_type: complete
            show_entity_picture: true
          - entity: person.nora
            display_type: complete
            show_entity_picture: true
          - entity: person.nina
            display_type: complete
            show_entity_picture: true
          - entity: person.niklas
            display_type: complete
            show_entity_picture: true
          - entity: person.dominik
            display_type: complete
            show_entity_picture: true
        state_filter:
          - home
          - not_home
      - type: custom:mushroom-template-badge
        entity: group.nodestates_core
        content: Geräte
        icon: "{{ 'mdi:checkbox-marked-circle' if is_state ( entity, 'on' ) else 'mdi:alert-circle-outline' }}"
        color: "{{ 'limegreen' if is_state ( entity, 'on' ) else 'red' }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: group.windows
        content: Fenster
        icon: "{{ 'mdi:checkbox-marked-circle' if is_state ( entity, 'off' ) else 'mdi:alert-circle-outline' }}"
        color: "{{ 'limegreen' if is_state ( entity, 'off' ) else 'red' }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: group.doors
        content: Türen
        icon: "{{ 'mdi:checkbox-marked-circle' if is_state ( entity, 'off' ) else 'mdi:alert-circle-outline' }}"
        color: "{{ 'limegreen' if is_state ( entity, 'off' ) else 'red' }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: group.batteries
        content: Batterien
        icon: "{{ 'mdi:battery-check' if is_state ( entity, 'off' ) else 'mdi:battery-alert' }}"
        color: "{{ 'limegreen' if is_state ( entity, 'off' ) else 'red' }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.grid_state
        content: Strom
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.pv_generating
        content: Solar
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.battery_state
        content: Batterie
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.wallbox_state
        content: Wallbox
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
        hold_action:
            action: url
            url_path: https://nodesathome1:7070
      - type: custom:mushroom-template-badge
        entity: group.ev6
        content: EV6
        icon: "{{ 'mdi:checkbox-marked-circle' if is_state ( entity, 'off' ) else 'mdi:alert-circle-outline' }}"
        color: "{{ 'limegreen' if is_state ( entity, 'off' ) else 'red' }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.wasserampel
        content: Wasserampel
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: sun.sun
        content: "{{ iif ( is_state ( entity, 'above_horizon' ), 'Tag', 'Nacht' ) }}"
        icon: "{{ iif ( is_state ( entity, 'above_horizon' ), 'mdi:white-balance-sunny', 'mdi:weather-night' ) }}"
        color: "{{ iif ( is_state ( entity, 'above_horizon' ), 'amber', 'indigo' ) }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: sensor.ups_status
        content: USV
        icon: mdi:power-plug-battery
        color: "{{ iif ( is_state ( entity, 'Online' ), 'limegreen', 'red' ) }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.gardena_smart_system_connection
        content: Gardena
        icon: mdi:flower
        color: "{{ iif ( is_state ( entity, 'on' ), 'limegreen', 'red' ) }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: sensor.cpu_temp
        content: "{{ states ( 'sensor.cpu_temp', with_unit = true ) }}"
        icon: mdi:memory
        color: "{{ iif ( states ( entity ) | float <= 50.0, 'limegreen', 'red' ) }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: alarm_control_panel.intrusion_detection_system
        content: Alarm
        icon: mdi:shield-lock
        color: "{{ 'grey' if is_state ( entity, 'disarmed' ) else 'limegreen' if is_state ( entity, 'armed_away' ) else 'red' }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.wassermelder
        content: Flut
        icon: mdi:home-flood
        color: "{{ 'limegreen' if is_state ( entity, 'off' ) else 'red' }}"
        tap_action:
            action: more-info

    cards:
      - type: vertical-stack
        cards:
          - type: horizontal-stack
            cards:
              - type: weather-forecast
                name: Wettervorhersage
                entity: weather.openweathermap
                show_forecast: true
                forecast_type: daily
          # - type: horizontal-stack
          #   cards:
          #     - type: tile
          #       entity: binary_sensor.eingangstur
          #     - type: tile
          #       entity: binary_sensor.nebentur
          #     - type: tile
          #       entity: binary_sensor.garagentur
          # - type: horizontal-stack
          #   cards:
          #     - type: tile
          #       entity: lock.eingangstur
          #     - type: tile
          #       entity: lock.nebentur
          #     - type: tile
          #       entity: lock.garagentur
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                entity: sensor.entry_doorlock
                primary: "{{ state_attr ( entity, 'name' ) }}"
                secondary: "{{ state_attr ( entity, 'text' ) }}"
                icon: "{{ state_attr ( entity, 'icon' ) }}"
                icon_color: "{{ state_attr ( entity, 'icon_color' ) }}"
                tap_action:
                    action: more-info
                    entity: lock.eingangstur
              - type: custom:mushroom-template-card
                entity: sensor.postern_doorlock
                primary: "{{ state_attr ( entity, 'name' ) }}"
                secondary: "{{ state_attr ( entity, 'text' ) }}"
                icon: "{{ state_attr ( entity, 'icon' ) }}"
                icon_color: "{{ state_attr ( entity, 'icon_color' ) }}"
                tap_action:
                    action: more-info
                    entity: lock.nebentur
              - type: custom:mushroom-template-card
                entity: sensor.garage_doorlock
                primary: "{{ state_attr ( entity, 'name' ) }}"
                secondary: "{{ state_attr ( entity, 'text' ) }}"
                icon: "{{ state_attr ( entity, 'icon' ) }}"
                icon_color: "{{ state_attr ( entity, 'icon_color' ) }}"
                tap_action:
                    action: more-info
                    entity: lock.garagentur
          - type: horizontal-stack
            cards:
              - type: tile
                entity: sensor.dht22_terrace_temperature
                icon: mdi:thermometer
              - type: tile
                entity: sensor.dht22_lounge_pressure
                icon: mdi:gauge
              - type: tile
                #entity: sensor.tileboard_temperature_template
                entity: sensor.relay_garage_temperature
                icon: mdi:thermometer
          - type: horizontal-stack
            cards:
              - type: tile
                entity: sensor.ems_esp_boiler_dhw_current_intern_temperature
                name: Warmwasser
                icon: mdi:thermometer
              - type: tile
                entity: sensor.dht11_utilityroom_temperature
                icon: mdi:thermometer
              - type: tile
                entity: sensor.ds18b20_pool_temperature
                icon: mdi:thermometer
          - type: horizontal-stack
            cards:
              - type: tile
                entity: input_boolean.climate_absence_goon
                name: Anlassen
                icon: mdi:hvac
              - type: tile
                entity: sensor.lux_dining_ambientlight
              - type: markdown
                content: " "
          - type: horizontal-stack
            cards:
              - type: custom:state-switch
                entity: >-
                    {%
                        if
                            (
                                is_state ( 'binary_sensor.prod_mode', 'on' )
                                or is_state ( 'input_boolean.show_debug_fields', 'on' )
                            )
                    %}
                    {%
                            if
                                states ( 'camera.tapo_c520ws_5d82_hd_stream' ) in ( 'unavailable', 'unknown' )
                                or is_state ( 'switch.tapo_c520ws_5d82_privacy', 'on' )
                    %}
                        nostream
                    {%      else %}
                        stream
                    {%      endif %}
                    {% else %}
                        off
                    {% endif %}
                default: "off"
                states:
                  "stream":
                      type: picture-entity
                      entity: camera.tapo_c520ws_5d82_hd_stream
                      double_tap_action:
                          action: url
                          url_path: http://c520ws.fritz.box/api/camera_proxy/camera.tapo_c520ws_5d82_hd_stream?token=13565e4c1c8028fd86e5ddf1045144bf4ff295e36aba2dbfa9c6fca92b7475b1
                  "nostream":
                      type: button
                      name: Garten
                      icon: mdi:cctv-off
                      tap_action:
                          action: none
                      hold_action:
                          action: none
                      double_tap_action:
                          action: none
                      more_info:
                          action: none
                  "off":
                      type: button
                      name: Garten
                      icon: mdi:camera-off
                      tap_action:
                          action: none
                      hold_action:
                          action: none
                      double_tap_action:
                          action: none
                      more_info:
                          action: none
              - type: markdown
                content: " "
              - type: markdown
                content: " "
      - type: vertical-stack
        cards:
          - type: horizontal-stack
            cards:
              - type: tile
                entity: climate.office
                name: Büro
                vertical: true
                features:
                  - type: "target-temperature"
                  - type: "climate-hvac-modes"
                    style: icons
                    hvac_modes:
                      - cool
                      - "off"
              - type: tile
                entity: climate.bedroom
                name: Schlafzimmer
                vertical: true
                features:
                  - type: "target-temperature"
                  - type: "climate-hvac-modes"
                    style: icons
                    hvac_modes:
                      - cool
                      - "off"
          - type: horizontal-stack
            cards:
              - type: tile
                entity: climate.nursery
                name: Kinderzimmer
                vertical: true
                features:
                  - type: "target-temperature"
                  - type: "climate-hvac-modes"
                    style: icons
                    hvac_modes:
                      - cool
                      - "off"
              - type: tile
                entity: climate.ems_esp_thermostat_hc1
                name: Heizung
                vertical: true
                features:
                  - type: "target-temperature"
                  - type: "climate-hvac-modes"
                    style: icons
                    hvac_modes:
                      - auto
                      - "off"
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-media-player-card
                entity: media_player.sony_kd_55ag9
                layout: vertical
                icon: mdi:television
                media_controls:
                  #- repeat
                  #- next
                  - play_pause_stop
                  #- previous
                  #- shuffle
                  - on_off
                volume_controls:
                  - volume_mute
                  - volume_set
                  - volume_buttons
                show_volume_level: true
                use_media_info: true
              - type: markdown
                content: " "

      - type: vertical-stack
        cards:
          - type: horizontal-stack
            cards:
              - type: entity-button
                entity: light.automatic_indoor_lights
                tap_action:
                    action: toggle
                hold_action:
                    action: more-info
              - type: entity-button
                entity: light.automatic_outdoor_lights
                tap_action:
                    action: toggle
                hold_action:
                    action: more-info
          - type: horizontal-stack
            cards:
              - type: light
                entity: light.led_kitchen_led
              - type: light
                entity: light.led_kitchen2_led
              - type: light
                entity: light.led_corridor_led
              - type: light
                entity: light.ws2812_office
          - type: horizontal-stack
            cards:
              - type: light
                entity: light.deckenlicht_dusche
                name: Dusche
                icon: mdi:ceiling-light
              - type: light
                entity: light.deckenlicht_bad
                name: Bad
                icon: mdi:ceiling-light
              - type: custom:state-switch
                entity: "{{ 'visible' if states ( 'light.ws2812_xmasstar' ) in ['on', 'off'] else 'unvisible' }}"
                default: "unvisible"
                states:
                  "visible":
                      type: light
                      entity: light.ws2812_xmasstar
                  "unvisible":
                      type: markdown
                      content: " "
                      show_empty: false
              - type: markdown
                content: " "
          - type: horizontal-stack
            cards:
              - type: button
                entity: cover.rooflights
                tap_action:
                    action: call-service
                    service: cover.stop_cover
                    data:
                        entity_id: cover.rooflights
                double_tap_action:
                    action: toggle
                hold_action:
                    action: more-info
              - type: entity-button
                entity: switch.shelly_bambulab_x1c
                name: 3D Drucker
                icon: mdi:printer-3d
                tap_action:
                    action: more-info
                hold_action:
                    action: more-info
              - type: entity-button
                entity: switch.shelly_xtool_m1ultra
                name: xTool M1 Ultra
                icon: mdi:box-cutter
                tap_action:
                    action: more-info
                hold_action:
                    action: more-info
              - type: entity-button
                entity: switch.shelly_xtool_safetypro
                name: xTool SafetyPro
                icon: mdi:air-filter
                tap_action:
                    action: more-info
                hold_action:
                    action: more-info
              #- type: markdown
              #  content: " "
          - type: horizontal-stack
            cards:
              - type: entity-button
                entity: switch.wasserpumpe
                icon: mdi:water-pump
                tap_action:
                    action: more-info
                hold_action:
                    action: more-info
              - type: entity-button
                entity: switch.relay_garden_valve3
                icon: mdi:watering-can
              - type: entity-button
                entity: switch.relay_garden_valve2
                icon: mdi:watering-can
              - type: entity-button
                entity: switch.relay_garden_valve1
                icon: mdi:watering-can
          - type: horizontal-stack
            cards:
              - type: entity-button
                entity: switch.relay_garden2_valve1
                icon: mdi:watering-can
              # - type: entity-button
              #   entity: switch.relay_garden2_valve2
              #   icon: mdi:watering-can
              - type: entity-button
                entity: switch.relay_garden2_valve3
                icon: mdi:watering-can
              - type: entity-button
                entity: switch.relay_hydrotower_pump
                icon: mdi:pump
              - type: entity-button
                entity: switch.poolpumpe
                icon: mdi:pump
          - type: horizontal-stack
            cards:
              - type: entity-button
                entity: switch.bosch_ladestation
                icon: mdi:power-plug-battery
                tap_action:
                    action: toggle
                hold_action:
                    action: more-info
              - type: markdown
                content: " "
              - type: markdown
                content: " "
              - type: markdown
                content: " "

  - title: Haus
    path: house
    panel: false
    badges:
      - type: entity-filter
        entities:
          - entity: person.andreas
            display_type: complete
            show_entity_picture: true
          - entity: person.undine
            display_type: complete
            show_entity_picture: true
          - entity: person.nora
            display_type: complete
            show_entity_picture: true
          - entity: person.nina
            display_type: complete
            show_entity_picture: true
          - entity: person.niklas
            display_type: complete
            show_entity_picture: true
          - entity: person.dominik
            display_type: complete
            show_entity_picture: true
        state_filter:
          - "home"
      - type: entity-filter
        entities:
          - entity: binary_sensor.bewegungsmelder1
            display_type: complete
          - entity: binary_sensor.smokedetectionsystem
            display_type: complete
          - entity: binary_sensor.rauchmelder_esszimmer
            display_type: complete
          - entity: binary_sensor.rauchmelder_wohnzimmer
            display_type: complete
          - entity: binary_sensor.rauchmelder_flur
            display_type: complete
          - entity: binary_sensor.rauchmelder_hauswirtsch
            display_type: complete
          - entity: binary_sensor.rauchmelder_galerie
            display_type: complete
          - entity: binary_sensor.rauchmelder_schlafzimmer
            display_type: complete
          - entity: binary_sensor.rauchmelder_buro
            display_type: complete
          - entity: binary_sensor.rauchmelder_kinderzimmer
            display_type: complete
          - entity: binary_sensor.rauchmelder_garage
            display_type: complete
          - entity: binary_sensor.rauchmelder_dachboden
            display_type: complete
        state_filter:
          - "on"
      - type: entity-filter
        entities:
          - entity: binary_sensor.eingangstur
            display_type: complete
          - entity: binary_sensor.nebentur
            display_type: complete
          - entity: binary_sensor.garagentur
            display_type: complete
          - entity: binary_sensor.garagentor
            display_type: complete
          - entity: binary_sensor.terassentur_kuche
            display_type: complete
          - entity: binary_sensor.terassentur_esszimmer
            display_type: complete
          - entity: binary_sensor.terassentur_wohnzimmer
            display_type: complete
          - entity: binary_sensor.fenster_arbeitszimmer
            display_type: complete
          - entity: binary_sensor.dachfenster_arbeitszimmer
            display_type: complete
          - entity: binary_sensor.fenster_kinderzimmer
            display_type: complete
          - entity: binary_sensor.dachfenster_kinderzimmer
            display_type: complete
          - entity: binary_sensor.fenster_schlafzimmer
            display_type: complete
          - entity: binary_sensor.dachfenster_schlafzimmer
            display_type: complete
          - entity: binary_sensor.fenster_bad
            display_type: complete
          - entity: binary_sensor.dachfenster_bad
            display_type: complete
          - entity: binary_sensor.dachfenster_galerie
            display_type: complete
          - entity: binary_sensor.fenster_flur
            display_type: complete
          - entity: binary_sensor.fenster_wohnzimmer_1
            display_type: complete
          - entity: binary_sensor.fenster_wohnzimmer_2
            display_type: complete
          - entity: binary_sensor.fenster_wohnzimmer_3
            display_type: complete
          - entity: binary_sensor.fenster_wohnzimmer_4
            display_type: complete
          - entity: binary_sensor.fenster_wohnzimmer_5
            display_type: complete
          - entity: binary_sensor.fenster_wohnzimmer_6
            display_type: complete
          - entity: binary_sensor.fenster_dusche
            display_type: complete
          - entity: input_boolean.cover_closed_at_low_temp
            display_type: complete
        state_filter:
          # on = open, off = closed
          - "on"
      - type: entity-filter
        entities:
          - entity: vacuum.erdgeschoss
            display_type: complete
          - entity: vacuum.obergeschoss
            display_type: complete
        state_filter:
          - operator: "!="
            value: "docked"

    cards:
      - type: vertical-stack
        title: Erdgeschoss
        cards:
          - type: glance
            title: Staubsauger
            entities:
              - vacuum.erdgeschoss
              - entity: image.erdgeschoss
                name: Karte
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
          - type: glance
            title: Küche
            columns: 3
            entities:
              - light.shelly_kitchen_shortstrip
              - light.shelly_kitchen_longstrip
              - entity: light.led_kitchen_led
                name: Arbeitslicht
              - light.led_kitchen2_led
              - entity: sensor.bosch_smv88tx16d_68a40e0c161c_bsh_common_status_operationstate
                name: Geschirrspüler
              - entity: binary_sensor.bosch_smv88tx16d_68a40e0c161c_bsh_common_status_doorstate
                name: Geschirrspüler
              - entity: switch.geschirrspuler
                icon: mdi:dishwasher
              - entity: number.siemens_ki81fhdd0_68a40ea89517_refrigeration_fridgefreezer_setting_setpointtemperaturerefrigerator
                name: Kühlschrank
              - entity: switch.siemens_ki81fhdd0_68a40ea89517_refrigeration_fridgefreezer_setting_supermoderefrigerator
                name: Supercooling
              - entity: binary_sensor.siemens_ki81fhdd0_68a40ea89517_bsh_common_status_doorstate
                name: Kühlschrank
              - entity: switch.kuhlschrank
                icon: mdi:fridge-industrial-outline
              - switch.shelly_kitchen_coffeemaker
              - switch.shelly_kitchen_icemaker
              - entity: binary_sensor.terassentur_kuche
                name: Terassentür
              - entity: climate.room_climate_kuche
                name: Thermostat
            card_mod:
              style: |
                $: |
                  .card-header {
                      display: flex;
                      flex-direction: row;
                      font-size: 18px;
                      line-height: 18px;
                  }
                  .card-header::after {
                      flex: 1 1 50%;
                      color: var(--secondary-text-color);
                      font-size: 1rem;
                      text-align: right;
                      content: "{{ states ( 'sensor.thermostat_kuche_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_kuche_humidity' ) | round ( 1 ) | string + '%' }}";
                  }
          - type: glance
            title: Esszimmer
            columns: 3
            entities:
              - entity: light.shelly_esszimmer1
                name: Deckenlampe
                icon: mdi:ceiling-light
              - entity: light.shelly_esszimmer2_switch_0
                name: Wandlicht links
              - entity: light.shelly_esszimmer2_switch_1
                name: Wandlicht rechts
              - light.shelly_esszimmerschrank1
              - light.shelly_esszimmerschrank2
              - light.ws2812_xmasstar
              - light.shelly_dining_xmastree
              # Xmas
              # - light.xmastreedining_leds
              - entity: binary_sensor.terassentur_esszimmer
                name: Terassentür
              - entity: climate.room_climate_esszimmer
                name: Thermostat
              - entity: binary_sensor.rauchmelder_esszimmer
                name: Rauchmelder
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_esszimmer_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_esszimmer_humidity' ) | round ( 1 ) | string + '%' }}";
                }
          - type: glance
            title: Wohnzimmer
            columns: 3
            entities:
              - entity: light.shelly_wohnzimmer_switch_0
                name: Deckenlampe Couch
                icon: mdi:ceiling-light
              - entity: light.shelly_wohnzimmer_switch_1
                name: Deckenlampe Tisch
                icon: mdi:ceiling-light
              - light.shelly_lounge_whiteball
              - light.shelly_lounge_blackbowl
              - light.shelly_lounge_readinglamp
              - entity: switch.schreibtisch_wohnzimmer
                name: Schreibtisch
                icon: mdi:chair-rolling
              - entity: switch.fernseher
                icon: mdi:television
              - entity: binary_sensor.terassentur_wohnzimmer
                name: Terassentür
              - entity: binary_sensor.fenster_wohnzimmer_1
                name: Fenster 1
              - entity: binary_sensor.fenster_wohnzimmer_2
                name: Fenster 2
              - entity: binary_sensor.fenster_wohnzimmer_3
                name: Fenster 3
              - entity: binary_sensor.fenster_wohnzimmer_4
                name: Fenster 4
              - entity: binary_sensor.fenster_wohnzimmer_5
                name: Fenster 5
              - entity: binary_sensor.fenster_wohnzimmer_6
                name: Fenster 6
              - entity: climate.room_climate_wohnzimmer
                name: Thermostat
              - entity: binary_sensor.rauchmelder_wohnzimmer
                name: Rauchmelder
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_wohnzimmer_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_wohnzimmer_humidity' ) | round ( 1 ) | string + '%' }}";
                }
          - type: glance
            title: Flur
            columns: 3
            entities:
              - entity: light.shelly_flur
                name: Deckenlampe
                icon: mdi:ceiling-light
              - binary_sensor.eingangstur
              - entity: binary_sensor.fenster_flur
                name: Fenster
              - entity: climate.room_climate_flur
                name: Thermostat
              - entity: binary_sensor.rauchmelder_flur
                name: Rauchmelder
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_flur_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_flur_humidity' ) | round ( 1 ) | string + '%' }}";
                }
          - type: glance
            title: Korridor
            columns: 3
            entities:
              - entity: light.shelly_korridor
                name: Deckenlampe
                icon: mdi:ceiling-light
              - entity: light.shelly_corridor_studypillar
              - light.led_corridor_led
              - light.pitouch_corridor_screen
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
          - type: glance
            title: Dusche
            columns: 3
            entities:
              - entity: light.deckenlicht_dusche
                name: Deckenlampe
                icon: mdi:ceiling-light
              - entity: binary_sensor.fenster_dusche
                name: Fenster
              - entity: climate.room_climate_dusche
                name: Thermostat
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_dusche_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_dusche_humidity' ) | round ( 1 ) | string + '%' }}";
                }
          - type: glance
            title: Hauswirtschaftsraum
            columns: 3
            entities:
              - binary_sensor.nebentur
              - binary_sensor.katzenklappe
              - entity: climate.room_climate_hauswirtschaftsraum
                name: Thermostat
              - switch.waschmaschine
              - switch.rechenzentrum
              - switch.nodesathome1
              - switch.nodesathome2
              - switch.shelly_utilityroom_circulatingpump
              - switch.shelly_utilityroom_boiler
              - switch.shelly_utilityroom_biocat
              - entity: sensor.ems_esp_boiler_dhw_current_extern_temperature
                name: Warmwasser
              - entity: switch.ems_esp_boiler_dhw_one_time_charging
                name: Warmwasser sofort
              - entity: binary_sensor.rauchmelder_hauswirtsch
                name: Rauchmelder
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_hauswirtschaft_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_hauswirtschaft_humidity' ) | round ( 1 ) | string + '%' }}";
                }

      - type: vertical-stack
        title: Obergeschoss
        cards:
          - type: glance
            title: Staubsauger
            entities:
              - vacuum.obergeschoss
              - entity: image.obergeschoss
                name: Karte
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
          - type: glance
            title: Galerie
            columns: 3
            entities:
              - entity: light.shelly_galerie
                name: Deckenlampe
                icon: mdi:ceiling-light
              - light.sonoff_gallery1_socket
              - entity: light.shelly_treppe
                name: Treppe
              - entity: binary_sensor.dachfenster_galerie
                name: Dachfenster
              - entity: climate.room_climate_galerie
                name: Thermostat
              - entity: binary_sensor.rauchmelder_galerie
                name:  Rauchmelder
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_galerie_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_galerie_humidity' ) | round ( 1 ) | string + '%' }}";
                }
          - type: glance
            title: Schlafzimmer
            columns: 3
            entities:
              - entity: light.shelly_schlafzimmer
                name: Deckenlampe
                icon: mdi:ceiling-light
              - light.sonoff_bedroom_socket
              - type: thermostat
                entity: climate.bedroom
                name: Klimaanlage
              - entity: switch.klimaanlage_schlafzimmer
                name: Klimaanlage
              - entity: binary_sensor.fenster_schlafzimmer
                name: Fenster
              - entity: binary_sensor.dachfenster_schlafzimmer
                name: Dachfenster
              - entity: cover.bedroom
                name: Rolladen
              - entity: climate.room_climate_schlafzimmer
                name: Thermostat
              - entity: binary_sensor.rauchmelder_schlafzimmer
                name:  Rauchmelder
              # - switch.fenster_schlafzimmer
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_schlafzimmer_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_schlafzimmer_humidity' ) | round ( 1 ) | string + '%' }}";
                }
          - type: glance
            title: Kinderzimmer
            columns: 3
            entities:
              - entity: light.shelly_kinderzimmer
                name: Deckenlampe
                icon: mdi:ceiling-light
              - type: thermostat
                entity: climate.nursery
                name: Klimaanlage
              - entity: switch.klimaanlage_kinderzimmer
                name: Klimaanlage
              - entity: binary_sensor.fenster_kinderzimmer
                name: Fenster
              - entity: binary_sensor.dachfenster_kinderzimmer
                name: Dachfenster
              - entity: cover.nursery
                name: Rolladen
              - entity: climate.room_climate_kinderzimmer
                name: Thermostat
              - entity: binary_sensor.rauchmelder_kinderzimmer
                name:  Rauchmelder
              # - switch.fenster_kinderzimmer
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_kinderzimmer_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_kinderzimmer_humidity' ) | round ( 1 ) | string + '%' }}";
                }
          - type: glance
            title: Arbeitszimmer
            columns: 3
            entities:
              - entity: light.shelly_arbeitszimmer
                name: Deckenlampe
                icon: mdi:ceiling-light
              - light.sonoff_corridor_lamp
              - light.ws2812_office
              - entity: switch.schreibtisch_arbeitszimmer
                name: Schreibtisch
                icon: mdi:chair-rolling
              - entity: switch.shelly_bambulab_x1c
                name: Bambulab X1C
                icon: mdi:printer-3d
              - entity: switch.shelly_xtool_m1ultra
                name: xTool M1 Ultra
                icon: mdi:box-cutter
              - entity: switch.shelly_xtool_safetypro
                name: xTool SafetyPro
                icon: mdi:air-filter
              - type: thermostat
                entity: climate.office
                name: Klimaanlage
              - entity: switch.klimaanlage_arbeitszimmer
                name: Klimaanlage
              - entity: binary_sensor.fenster_arbeitszimmer
                name: Fenster
              - entity: binary_sensor.dachfenster_arbeitszimmer
                name: Dachfenster
              - entity: cover.office
                name: Rolladen
              - entity: climate.room_climate_arbeitszimmer
                name: Thermostat
              - entity: binary_sensor.rauchmelder_buro
                name:  Rauchmelder
              # - switch.fenster_arbeitszimmer
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_arbeitszimmer_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_arbeitszimmer_humidity' ) | round ( 1 ) | string + '%' }}";
                }
          - type: glance
            title: Bad
            columns: 3
            entities:
              - entity: light.deckenlicht_bad
                name: Deckenlampe
                icon: mdi:ceiling-light
              - entity: binary_sensor.fenster_bad
                name: Fenster
              - entity: binary_sensor.dachfenster_bad
                name: Dachfenster
              - entity: cover.bath
                name: Rolladen
              - entity: climate.room_climate_bad
                name: Thermostat
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.thermostat_bad_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.thermostat_bad_humidity' ) | round ( 1 ) | string + '%' }}";
                }

      - type: vertical-stack
        title: Dachgeschoss
        cards:
          - type: glance
            title: Dachboden
            columns: 3
            entities:
              - entity: light.shelly_dachboden
                name: Beleuchtung
              - entity: binary_sensor.fenster_dachboden
                name: Dachfenster
              - entity: binary_sensor.dachboden
                name: Bodenluke
              - entity: binary_sensor.rauchmelder_dachboden
                name: Rauchmelder
            card_mod:
              style: |
                .card-header {
                    display: flex;
                    flex-direction: row;
                    font-size: 18px;
                    line-height: 18px;
                }
                .card-header::after {
                    flex: 1 1 50%;
                    color: var(--secondary-text-color);
                    font-size: 1rem;
                    text-align: right;
                    content: "{{ states ( 'sensor.dht22_roof_temperature' ) | round ( 1 ) | string + '°C / ' + states ( 'sensor.dht22_roof_humidity' ) | round ( 1 ) | string + '%' }}";
                }

  - title: Außenbereich
    path: outdoor
    panel: false
    badges:
      - entity: sensor.rain_garden_precipitation_last7d
        name: 7 Tage
        display_type: complete
      - entity: sensor.rain_garden_precipitation_last5d
        name: 5 Tage
        display_type: complete
      - entity: sensor.rain_garden_precipitation_last24h
        name: 24h
        display_type: complete
      - entity: sensor.rain_garden_precipitation
        name: aktuell
        display_type: complete
      - entity: sensor.dht22_terrace_temperature_max
        display_type: complete
      - type: custom:mushroom-template-badge
        entity: binary_sensor.wallbox_state
        content: Wallbox
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
        hold_action:
            action: url
            url_path: https://nodesathome1:7070
      - type: custom:mushroom-template-badge
        entity: group.ev6
        content: EV6
        icon: "{{ 'mdi:checkbox-marked-circle' if is_state ( entity, 'off' ) else 'mdi:alert-circle-outline' }}"
        color: "{{ 'limegreen' if is_state ( entity, 'off' ) else 'red' }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.wasserampel
        content: Wasserampel
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.gardena_smart_system_connection
        content: Gardena
        icon: mdi:flower
        color: "{{ iif ( is_state ( entity, 'on' ), 'limegreen', 'red' ) }}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.wassermelder
        content: Flut
        icon: mdi:home-flood
        color: "{{ 'limegreen' if is_state ( entity, 'off' ) else 'red' }}"
        tap_action:
            action: more-info
      - type: entity-filter
        entities:
          - entity: binary_sensor.garagentur
            display_type: complete
          - entity: binary_sensor.garagentor
            display_type: complete
        state_filter:
          # on = open, off = closed
          - "on"
    cards:

      - type: vertical-stack
        title: Außenlichter
        cards:
          - type: glance
            columns: 3
            entities:
              - light.shelly_terasse
              - light.shelly_hinterhof
              - light.shelly_garagentor
              - light.shelly_gartentor
              -  light.shelly_lounge_schwibbogen1
              - light.shelly_lounge_schwibbogen2
              - light.shelly_entrance_star
              - light.shelly_entrance_drops
              - light.shelly_entrance_lightbirch

      - type: vertical-stack
        title: Garten
        cards:
          - type: glance
            title: Bewässerung
            card_mod:
                style: "ha-card .card-header { font-size: 18px; line-height: 18px; }"
            columns: 3
            entities:
                - switch.relay_garden_valve1
                - switch.relay_garden_valve2
                - switch.relay_garden_valve3
                - switch.relay_garden2_valve1
                - switch.relay_garden2_valve2
                - switch.relay_garden2_valve3
                - entity: switch.wasserpumpe
                  icon: mdi:water-pump
          - type: glance
            title: Hydrotower
            card_mod:
                style: "ha-card .card-header { font-size: 18px; line-height: 18px; }"
            columns: 3
            entities:
                - sensor.relay_hydrotower_temperature
                - switch.relay_hydrotower_pump
          - type: glance
            title: Beete
            card_mod:
                style: "ha-card .card-header { font-size: 18px; line-height: 18px; }"
            columns: 3
            entities:
                - sensor.gemusebeet_vorne_soil_humidity
                - sensor.gemusebeet_vorne_soil_temperature
                - sensor.gemusebeet_hinten_soil_humidity
                - sensor.gemusebeet_hinten_soil_temperature
                - sensor.hochbeet_vorne_soil_humidity
                - sensor.hochbeet_vorne_soil_temperature
                - sensor.hochbeet_hinten_soil_humidity
                - sensor.hochbeet_hinten_soil_temperature
          - type: conditional
            conditions:
              - entity: lawn_mower.sileno
                state_not: unavailable
            card:
                type: vertical-stack
                cards:
                  - type: picture-elements
                    title: Rasenmäher
                    card_mod:
                        style: "ha-card .card-header { font-size: 18px; line-height: 18px; }"
                    image: '/local/images/mower.jpg'
                    elements:
                      # central
                      - type: state-label
                        entity: lawn_mower.sileno
                        tap_action:
                          action: more-info
                        style:
                         top: 14%
                         right: 38%
                         color: rgb(255, 255, 255)
                         transform: translate(0%,-50%)
                         font-family: Trebuchet MS
                         font-size: 150%
                         font-weight: bold
                         border-color: rgb(34, 154, 210)
                         border-radius: 6px
                         background-color: '#cccccc'
                      - type: state-label
                        entity: lawn_mower.sileno
                        attribute: operating_hours
                        prefix: "Zeit: "
                        suffix: " h"
                        style:
                          top: 79%
                          left: 45%
                          color: '#84a6ba'
                          transform: translate(0%,-50%)
                          pointer-events: none
                          font-family: Trebuchet MS
                          font-size: 80%
                          font-weight: bold
                      # left
                      - type: state-label
                        entity: sensor.mower_operation
                        style:
                         top: 10%
                         left: 1%
                         color: rgb(255, 255, 255)
                         transform: translate(0%,-50%)
                         pointer-events: none
                         font-family: Trebuchet MS
                         font-size: 90%
                         font-weight: bold
                         border-color: rgb(34, 154, 210)
                         background-color: '#3090C7'
                         border-radius: 6px
                      - type: state-label
                        entity: lawn_mower.sileno
                        attribute: activity
                        prefix: "Status: "
                        style:
                          top: 40%
                          left: 1%
                          color: '#ffffff'
                          transform: translate(0%,-50%)
                          pointer-events: none
                          font-family: Trebuchet MS
                          font-size: 80%
                          font-weight: bold
                          border-left-style: solid
                          border-color: '#3090C7'
                      - type: state-label
                        entity: sensor.sileno_battery_level
                        prefix: "Batterie: "
                        style:
                          top: 50%
                          left: 1%
                          color: '#ffffff'
                          transform: translate(0%,-50%)
                          pointer-events: none
                          font-family: Trebuchet MS
                          font-size: 80%
                          font-weight: bold
                          border-left-style: solid
                          border-color: rgb(34, 154, 210)
                      - type: state-label
                        entity: lawn_mower.sileno
                        attribute: error
                        prefix: "Fehler: "
                        style:
                          top: 60%
                          left: 1%
                          color: '#ffffff'
                          transform: translate(0%,-50%)
                          pointer-events: none
                          font-family: Trebuchet MS
                          font-size: 80%
                          font-weight: bold
                          border-left-style: solid
                          border-color: rgb(34, 154, 210)
                      - type: state-label
                        entity: lawn_mower.sileno
                        attribute: last_error
                        prefix: "Meldung: "
                        style:
                          top: 70%
                          left: 1%
                          color: '#ffffff'
                          transform: translate(0%,-50%)
                          pointer-events: none
                          font-family: Trebuchet MS
                          font-size: 80%
                          font-weight: bold
                          border-left-style: solid
                          border-color: rgb(34, 154, 210)
                      # bottom
                      - type: icon
                        icon: mdi:play
                        tap_action:
                          action: call-service
                          service: lawn_mower.start_mowing
                          service_data:
                              entity_id: lawn_mower.sileno
                        style:
                         top: 90%
                         left: 35%
                         color: '#3090C7'
                      - type: icon
                        icon: mdi:stop
                        tap_action:
                          action: call-service
                          service: lawn_mower.pause
                          service_data:
                              entity_id: lawn_mower.sileno
                        style:
                         top: 90%
                         left: 50%
                         color: '#3090C7'
                      - type: icon
                        icon: mdi:home
                        tap_action:
                          action: call-service
                          service: lawn_mower.dock
                          service_data:
                              entity_id: lawn_mower.sileno
                        style:
                         top: 90%
                         left: 65%
                         color: '#3090C7'
                      # right
                      - type: state-label
                        entity: lawn_mower.sileno
                        attribute: rf_link_state
                        #prefix: "Netzwerk: "
                        style:
                         top: 10%
                         right: 1%
                         color: rgb(255, 255, 255)
                         transform: translate(0%,-50%)
                         pointer-events: none
                         font-family: Trebuchet MS
                         font-size: 90%
                         font-weight: bold
                         border-color: rgb(34, 154, 210)
                         background-color: '#3090C7'
                         border-radius: 6px
                      - type: state-label
                        entity: lawn_mower.sileno
                        attribute: rf_link_level
                        prefix: "Level: "
                        style:
                          top: 40%
                          right: 1%
                          color: '#ffffff'
                          transform: translate(0%,-50%)
                          pointer-events: none
                          font-family: Trebuchet MS
                          font-size: 76%
                          font-weight: bold
                          border-right-style: solid
                          border-color: rgb(34, 154, 210)
                  - type: entities
                    entities:
                    - entity: sensor.sileno_battery_level

      - type: vertical-stack
        title: Garage
        cards:
          - type: glance
            columns: 3
            entities:
              - light.shelly_garage1
              - light.shelly_garage2
              - cover.relay_garage
              - sensor.relay_garage_state
              - binary_sensor.garagentor
              - binary_sensor.garagentur
              - entity: switch.aussenkuhlschrank
                icon: mdi:fridge-outline
              - entity: switch.getrankekuhlschrank
                icon: mdi:fridge-variant-outline
              - entity: switch.bosch_ladestation
                icon: mdi:battery-charging-medium
              - binary_sensor.wassermelder
              - entity: binary_sensor.rauchmelder_garage
                name: Rauchmelder
      
      - type: vertical-stack
        title: Auto
        cards:
            # https://community.home-assistant.io/t/kia-uvo-integration/297927
          - type: picture-elements
            title: Kia EV6
            image: /local/images/kia_ev6.jpg
            elements:
                # top left
              - type: state-icon
                entity: lock.ev6_door_lock
                style:
                  top: 0px
                  left: 0px
                  margin-top: 0px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: lock.ev6_door_lock
                title: lock.ev6_door_lock
                style:
                  top: 0px
                  left: 30px
                  margin-top: 0px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
              - type: state-icon
                entity: binary_sensor.ev6_ev_charge_port
                style:
                  top: 0px
                  left: 0px
                  margin-top: 24px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: binary_sensor.ev6_ev_charge_port
                title: binary_sensor.ev6_ev_charge_port
                style:
                  top: 0px
                  left: 30px
                  margin-top: 24px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
              - type: state-icon
                entity: binary_sensor.ev6_ev_battery_plug
                style:
                  top: 0px
                  left: 0px
                  margin-top: 48px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: binary_sensor.ev6_ev_battery_plug
                style:
                  top: 0px
                  left: 30px
                  margin-top: 48px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
                # top right
              - type: state-icon
                entity: binary_sensor.ev6_hood
                style:
                  top: 0px
                  right: 0px
                  margin-top: 0px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: binary_sensor.ev6_hood
                style:
                  top: 0px
                  right: 30px
                  margin-top: 0px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
              - type: state-icon
                entity: binary_sensor.ev6_trunk
                style:
                  top: 0px
                  right: 0px
                  margin-top: 24px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: binary_sensor.ev6_trunk
                style:
                  top: 0px
                  right: 30px
                  margin-top: 24px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
              - type: state-icon
                entity: group.ev6_doors
                style:
                  top: 0px
                  right: 0px
                  margin-top: 48px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: group.ev6_doors
                style:
                  top: 0px
                  right: 30px
                  margin-top: 48px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
                # bottom left
              - type: state-icon
                entity: sensor.ev6_ev_range
                style:
                  bottom: 0px
                  left: 0px
                  margin-bottom: 24px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: sensor.ev6_ev_range
                title: sensor.ev6_ev_range
                prefix: 'Range: '
                style:
                  bottom: 0px
                  left: 30px
                  margin-bottom: 24px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
              - type: state-icon
                entity: sensor.ev6_ev_battery_level
                style:
                  bottom: 0px
                  left: 0px
                  margin-bottom: 0px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: sensor.ev6_ev_battery_level
                title: sensor.ev6_ev_battery_level
                prefix: 'Battery: '
                style:
                  bottom: 0px
                  left: 30px
                  margin-bottom: 0px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
                # bottom right
              - type: state-icon
                entity: device_tracker.ev6_location
                style:
                  bottom: 0px
                  right: 0px
                  margin-bottom: 48px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: device_tracker.ev6_location
                style:
                  bottom: 0px
                  right: 30px
                  margin-bottom: 48px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
              - type: state-icon
                entity: sensor.ev6_odometer
                style:
                  bottom: 0px
                  right: 0px
                  margin-bottom: 24px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: sensor.ev6_odometer
                style:
                  bottom: 0px
                  right: 30px
                  margin-bottom: 24px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black
              - type: state-icon
                entity: sensor.ev6_last_updated_at
                style:
                  bottom: 0px
                  right: 0px
                  margin-bottom: 0px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  '--paper-item-icon-color': black
              - type: state-label
                entity: sensor.ev6_last_updated_at
                style:
                  bottom: 0px
                  right: 30px
                  margin-bottom: 0px
                  transform: initial
                  font-size: 0.8em
                  line-height: 2em
                  color: black

              # - type: state-icon
              #   entity: binary_sensor.ev6_ev_battery_charge
              #   style:
              #     right: 0
              #     top: 0px
              #     margin-top: 0px
              #     transform: initial
              #     font-size: 0.8em
              #     line-height: 2em
              #     '--paper-item-icon-color': black
              # - type: state-label
              #   entity: binary_sensor.ev6_ev_battery_charge
              #   style:
              #     transform: initial
              #     font-size: 0.8em
              #     line-height: 2em
              #     top: 0px
              #     right: 30px
              #     margin-top: 0px
              #     color: black
          - type: custom:mushroom-number-card
            entity: number.ev6_ac_charging_limit
            layout: horizontal
            display_mode: buttons
          - type: conditional
            conditions:
              - entity: sensor.go_echarger_power_total
                state_not: unavailable
            card:
                type: entities
                title: Wallbox
                show_header_toggle: false
                entities:
                  - type: section
                    label: evcc
                  - entity: sensor.wallbox_charge_remaining_duration
                    name: Laderestzeit
                    icon: mdi:av-timer
                  - sensor.evcc_wallbox_charge_remaining_energy
                  - type: section
                    label: Kia EV 6
                  - sensor.evcc_wallbox_vehicle_odometer
                  - sensor.evcc_wallbox_vehicle_range
                  - sensor.evcc_wallbox_vehicle_soc

      - type: conditional
        conditions:
          - entity:
                - sensor.ds18b20_pool_temperature
            state_not: "unknown"
        card:
            type: vertical-stack
            cards:
              - type: vertical-stack
                title: Pool
                cards:
                  - type: glance
                    columns: 3
                    entities:
                        - entity: switch.poolpumpe
                          icon: mdi:pump
                  - type: gauge
                    name: Pooltemperatur
                    entity: sensor.ds18b20_pool_temperature
                    min: 15
                    max: 30
                    unit: °C
                  - type: gauge
                    name: Akkuspannung
                    entity: sensor.ds18b20_pool_voltage
                    min: 2.5
                    max: 4.5
                    unit: V
                    severity:
                        green:  3.9
                        yellow: 3.2
                        red:    0.0
                  - type: history-graph
                    title: Temperaturen
                    hours_to_show: 168 # one week
                    refersh_interval: 1800 # 30 min
                    entities:
                      - sensor.ds18b20_pool_temperature
                      - sensor.dht22_terrace_temperature
                      # - sensor.ds18b20_pool_voltage

  - title: Ressourcen
    path: ressources
    panel: false
    badges:
      - type: custom:mushroom-template-badge
        entity: binary_sensor.grid_state
        content: Netz
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.pv_generating
        content: Solar
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.battery_state
        content: Batterie
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.sh10rt_master_inverter_state_badge
        content: Master
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.sh10rt_slave_inverter_state_badge
        content: Slave
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.wallbox_state
        content: Wallbox
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
        hold_action:
            action: url
            url_path: https://nodesathome1:7070
      - type: custom:mushroom-template-badge
        entity: binary_sensor.boiler_gas_state_badge
        content: Gas
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
      - type: custom:mushroom-template-badge
        entity: binary_sensor.waterflow_state_badge
        content: Wasser
        icon: "{{ state_attr ( entity, 'icon' )}}"
        color: "{{ state_attr ( entity, 'icon_color' )}}"
        tap_action:
            action: more-info
    cards:
      - type: vertical-stack
        cards:
          - type: gauge
            name: Netzleistung
            entity: sensor.electricity_meter_power
            min: -5000
            max: +5000
            needle: true
            segments:
              - from: -5000
                color: '#ffa600'
              - from: 0
                color: '#3788d8'
          - type: entities
            title: Netz
            show_header_toggle: false
            entities:
              - type: section
                label: Bezug
              - entity: sensor.tasmota_lk13be_energy_total_in
                name: Zählerstand
                icon: mdi:counter
              - entity: sensor.electricity_meter_daily_in
                name: täglich
                icon: mdi:transmission-tower-export
              - entity: sensor.electricity_meter_yearly_in
                name: jährlich
                icon: mdi:transmission-tower-export
              - type: section
                label: Einspeisung
              - entity: sensor.tasmota_lk13be_energy_total_out
                name: Zählerstand
                icon: mdi:counter
              - entity: sensor.electricity_meter_daily_out
                name: täglich
                icon: mdi:transmission-tower-import
              - entity: sensor.electricity_meter_yearly_out
                name: jährlich
                icon: mdi:transmission-tower-import
              - type: section
                label: Kosten
              - entity: sensor.electricity_daily_in_costs
                name: täglich
              - entity: sensor.electricity_yearly_in_costs
                name: jährlich
              - type: section
                label: Erlöse
              - entity: sensor.electricity_daily_out_returns
                name: täglich
              - entity: sensor.electricity_yearly_out_returns
                name: jährlich
              - type: section
                label: Strombörse
              - entity: sensor.epex_spot_data_price
                name: EPEX
              - entity: sensor.epex_spot_data_net_price
                name: ostrom (SimplyDynamic)
          - type: energy-distribution
          - type: statistics-graph
            title: Heutiger Verbrauch
            chart_type: bar
            period: hour
            days_to_show: 1
            entities:
              - sensor.electricity_meter_daily_in
              - sensor.electricity_meter_daily_out
              - sensor.load_meter_daily
              - sensor.gas_meter_daily
              - sensor.solar_meter_daily
              #- sensor.water_meter_daily
              - sensor.battery_meter_daily_out
              - sensor.battery_meter_daily_in
              - sensor.wallbox_meter_daily
            stat_types:
              - change
      - type: vertical-stack
        cards:
          - type: gauge
            name: Hauslast
            entity: sensor.load_power
            min: 0
            max: +5000
            # needle: true
            severity:
              green: 0
              yellow: 1000
              red: 4000
          - type: entities
            title: Haus
            show_header_toggle: false
            entities:
              - type: section
                label: Verbrauch
              - type: conditional
                conditions:
                  - entity: input_boolean.show_debug_fields
                    state: "on"
                row:
                    entity: sensor.daily_load
              - entity: sensor.load_meter_daily
                name: täglich
                icon: mdi:home-lightning-bolt-outline
              - entity: sensor.load_meter_yearly
                name: jährlich
                icon: mdi:home-lightning-bolt-outline
          - type: conditional
            conditions:
              - entity: sensor.go_echarger_power_total
                state_not: unavailable
            card:
                type: gauge
                name: Ladeleistung
                entity: sensor.wallbox_power
                min: 0
                max: +16000
                # needle: true
                severity:
                  green: 0
                  blue: 6000
                  red: 10000
          - type: conditional
            conditions:
              - entity: sensor.go_echarger_power_total
                state_not: unavailable
            card:
                type: entities
                title: Wallbox
                show_header_toggle: false
                entities:
                  - type: section
                    label: Ladung
                  - type: conditional
                    conditions:
                      - entity: input_boolean.show_debug_fields
                        state: "on"
                    row:
                        entity: sensor.go_echarger_energy_charge
                  - entity: sensor.wallbox_meter_daily
                    name: täglich
                    icon: mdi:ev-station
                  - entity: sensor.wallbox_meter_yearly
                    name: jährlich
                    icon: mdi:ev-station
          - type: entities
            title: Gas
            show_header_toggle: false
            entities:
              - type: section
                label: Bezug
              - entity: sensor.gas_meter_daily
                name: täglich
              - entity: sensor.gas_meter_yearly
                name: jährlich
              - type: divider
              - entity: sensor.gas_energy_daily
                name: täglich
              - entity: sensor.gas_energy_hotwater_daily
                name: "> davon Warmwasser"
              - entity: sensor.gas_energy_yearly
                name: jährlich
              - entity: sensor.gas_energy_hotwater_yearly
                name: "> davon Warmwasser"
              - type: section
                label: Kosten
              - entity: sensor.gas_daily_costs
                name: täglich
              - entity: sensor.gas_hotwater_daily_costs
                name: "> davon Warmwasser"
              - entity: sensor.gas_yearly_costs
                name: jährlich
              - entity: sensor.gas_hotwater_yearly_costs
                name: "> davon Warmwasser"
          - type: conditional
            conditions:
              - entity: input_boolean.show_debug_fields
                state: "on"
            card:
                type: entities
                title: Debug
                show_header_toggle: false
                entities:
                  - sensor.load_quarterhourly
                  - sensor.electricity_quarterhourly_in
                  - sensor.electricity_quarterhourly_out
                  - sensor.solar_quarterhourly
                  - sensor.battery_quarterhourly_in
                  - sensor.battery_quarterhourly_out
                  - sensor.gas_quarterhourly
                  - sensor.gas_hotwater_quarterhourly
                  - sensor.gas_volume_quarterhourly
      - type: vertical-stack
        cards:
          - type: gauge
            name: Solarleistung
            entity: sensor.total_dc_power
            min: 0
            max: 20000
            # needle: true
            severity:
                yellow: 0
                red: 20000
          - type: entities
            title: Solar
            show_header_toggle: false
            entities:
              - entity: sensor.sh10rt_master_total_dc_power
                name: Gartenseite
                icon: mdi:solar-power-variant-outline
              - entity: sensor.sh10rt_slave_total_dc_power
                name: Straßenseite
                icon: mdi:solar-power-variant-outline
              - type: section
                label: Vorhersage
                # solcast
              - entity: sensor.solcast_pv_forecast_prognose_heute
                name: heute
              - entity: sensor.solcast_pv_forecast_zeitpunkt_spitzenleistung_heute
                name: Peak
                icon: mdi:summit
              - entity: sensor.solcast_pv_forecast_prognose_morgen
                name: morgen
              - type: conditional
                conditions:
                  - entity: input_boolean.show_debug_fields
                    state: "on"
                row:
                    entity: sensor.solcast_pv_forecast_verwendete_api_abrufe
              - type: conditional
                conditions:
                  - entity: input_boolean.show_debug_fields
                    state: "on"
                row:
                    entity: sensor.solcast_pv_forecast_zeitpunkt_letzter_api_abruf
              - type: section
                label: Produktion
              - entity: sensor.solar_meter_daily
                name: täglich
                icon: mdi:solar-power
              - entity: sensor.solar_meter_yearly
                name: jährlich
                icon: mdi:solar-power
          - type: statistics-graph
            title: Solarproduktion letzte 30 Tage
            chart_type: line
            period: day
            days_to_show: 30
            entities:
              - entity: sensor.solar_meter_daily
                name: tägliche Produktion
              - entity: sensor.sh10rt_master_daily_pv_generation
                name: Gartenseite
              - entity: sensor.sh10rt_slave_daily_pv_generation
                name: Straßenseite
              # - sensor.load_meter_daily
            stat_types:
              - state
          - type: entities
            title: Wasser
            show_header_toggle: false
            entities:
              - type: section
                label: Bezug
              - entity: sensor.watermeter_value
                name: Zählerstand
              - entity: sensor.water_meter_daily
                name: täglich
              - entity: sensor.water_meter_yearly
                name: jährlich
              - type: section
                label: Kosten
              - entity: sensor.water_daily_costs
                name: täglich
              - entity: sensor.water_yearly_costs
                name: jährlich
      - type: vertical-stack
        cards:
          - type: gauge
            name: Batterieleistung
            entity: sensor.battery_power
            min: -5000
            max: +5000
            needle: true
            segments:
              - from: -5000
                color: '#ffa600'
              - from: 0
                color: '#3788d8'
          - type: gauge
            name: Batteriefüllung
            entity: sensor.sh10rt_master_battery_level
            min: 0
            max: 100
            severity:
              green: 70
              yellow: 25
              red: 10
          - type: entities
            title: Batterie
            show_header_toggle: false
            entities:
              - type: section
                label: Entladung
              - entity: sensor.battery_meter_daily_out
                name: täglich
                icon: mdi:battery-arrow-down
              - entity: sensor.battery_meter_yearly_out
                name: jährlich
                icon: mdi:battery-arrow-down
              - type: section
                label: Auftladung
              - entity: sensor.battery_meter_daily_in
                name: täglich
                icon: mdi:battery-arrow-down
              - entity: sensor.battery_meter_yearly_in
                name: jährlich
                icon: mdi:battery-arrow-down
              - type: section
                label: State of Charge
              - entity: sensor.sh10rt_master_max_soc
                name: maximal
              - entity: sensor.sh10rt_master_reserved_soc_for_backup
                name: Reserve für Backup
              - entity: sensor.sh10rt_master_min_soc
                name: minimal
          - type: conditional
            conditions:
              - entity: input_boolean.show_debug_fields
                state: "on"
            card:
                type: entities
                title: Spannungen, Ströme und Leistungen
                show_header_toggle: false
                entities:
                  - entity: sensor.sh10rt_master_battery_voltage
                    name: aktuell
                  - entity: sensor.battery_current
                    name: aktuell
                  - entity: sensor.sh10rt_master_bms_max_charging_current
                    name: maximaler Ladestrom
                  - entity: sensor.sh10rt_master_bms_max_discharging_current
                    name: maximaler Entladestrom
                  - entity: sensor.sh10rt_master_battery_charge_start_power
                    name: Ladestartleistung
                  - entity: sensor.sh10rt_master_battery_discharge_start_power
                    name: Entladestartleistung
                  - entity: sensor.sh10rt_master_battery_max_charge_power
                    name: maximale Ladeleistung
                  - entity: sensor.sh10rt_master_battery_max_discharge_power
                    name: maximale Entladeleistung
                  - entity: sensor.sh10rt_master_battery_forced_charge_discharge_power
                    name: Zwangslade-/entladeleistung
          - type: statistics-graph
            title: SoC letzte 30 Tage
            chart_type: line
            period: day
            days_to_show: 30
            entities:
              - sensor.sh10rt_master_battery_level
            stat_types:
              - min
              - max

  - title: Pflanzen
    path: plants
    panel: false
    badges:
      - type: entity-filter
        entities:
          - entity: plant.goldfruchtpalme_flowercare
            display_type: complete
          - entity: plant.birkenfeige_flowercare
            display_type: complete
          - entity: plant.palmlilie_flowercare
            display_type: complete
          - entity: plant.bogenhanf_flowercare
            display_type: complete
          - entity: plant.korbmarante_flowercare
            display_type: complete
          - entity: plant.fensterblatt_flowercare
            display_type: complete
          - entity: plant.gummibaum_flowercare
            display_type: complete
          - entity: plant.fliederaralie_flowercare
            display_type: complete
        state_filter:
          - "problem"

    cards:
      - type: vertical-stack
        title: Pflanzen
        cards:
          - type: plant-status
            name: Goldfruchtpalme - Dypsis lutescens
            card_mod:
                style: "ha-card .header { font-size: 18px; line-height: 18px; }"
            link: https://www.mein-schoener-garten.de/pflanzen/goldfruchtpalme/goldfruchtpalme
            entity: plant.goldfruchtpalme_flowercare
          - type: plant-status
            name: Birkenfeige - Ficus benjamina
            card_mod:
                style: "ha-card .header { font-size: 18px; line-height: 18px; }"
            link: https://www.mein-schoener-garten.de/pflanzen/feige/birkenfeige
            entity: plant.birkenfeige_flowercare
          - type: plant-status
            name: Riesen-Palmlilie - Yucca elephantipes
            card_mod:
                style: "ha-card .header { font-size: 18px; line-height: 18px; }"
            link: https://www.mein-schoener-garten.de/pflanzen/palmlilie-yucca/yucca-palme
            entity: plant.palmlilie_flowercare
          - type: plant-status
            name: Bogenhanf - Sansevieria trifasciata
            card_mod:
                style: "ha-card .header { font-size: 18px; line-height: 18px; }"
            link: https://www.mein-schoener-garten.de/pflanzen/bogenhanf-sansevieria
            entity: plant.bogenhanf_flowercare
          - type: plant-status
            name: Korbmarante - Calathea rufibarba
            card_mod:
                style: "ha-card .header { font-size: 18px; line-height: 18px; }"
            link: https://www.mein-schoener-garten.de/pflanzen/korbmarante/calathea-rufibarba
            entity: plant.korbmarante_flowercare
          - type: plant-status
            name: Fensterblatt - Monstera deliciosa
            card_mod:
                style: "ha-card .header { font-size: 18px; line-height: 18px; }"
            link: https://www.mein-schoener-garten.de/pflanzen/fensterblatt/monstera-fensterblatt
            entity: plant.fensterblatt_flowercare
          - type: plant-status
            name: Gummibaum - Ficus elastica
            card_mod:
                style: "ha-card .header { font-size: 18px; line-height: 18px; }"
            link: https://www.mein-schoener-garten.de/pflanzen/feige/gummibaum
            entity: plant.gummibaum_flowercare
          - type: plant-status
            name: Fiederaralie - Polyscias
            card_mod:
                style: "ha-card .header { font-size: 18px; line-height: 18px; }"
            link: https://www.mein-schoener-garten.de/pflanzen/fiederaralie/fiederaralie
            entity: plant.fiederaralie_flowercare

  - title: Grundriss
    path: floorplan
    panel: true
    visible: true
    cards:
      - type: 'custom:floorplan-card'
        full_height: true
        #config: /local/floorplans/groundlevel.yaml
        config:
          image:
            location: /local/floorplans/floorplan.svg
            cache: false
          stylesheet: /local/floorplans/assets/floorplan.css
          # log_level: debug
          console_log_level: debug
          defaults:
            hover_action: hover-info
            tap_action: more-info
          startup_action:
            - service: floorplan.class_set
              service_data:
                element: ground_floor
                class: layer-visible
            - service: floorplan.class_set
              service_data:
                element: first_floor
                class: layer-hidden
            - service: floorplan.class_set
              service_data:
                element: attic_floor
                class: layer-hidden
            - service: floorplan.class_set
              service_data:
                element: "ground_floor.button"
                class: button-on
            - service: floorplan.class_set
              service_data:
                element: "first_floor.button"
                class: button-off
            - service: floorplan.class_set
              service_data:
                element: "attic_floor.button"
                class: button-off
          rules:
            - name: Button Erdgeschoss
              element: ground_floor.button
              tap_action:
                - service: floorplan.class_set
                  service_data:
                    elements:
                      - ground_floor
                      - garage
                    class: layer-visible
                - service: floorplan.class_set
                  service_data:
                    element: first_floor
                    class: layer-hidden
                - service: floorplan.class_set
                  service_data:
                    element: attic_floor
                    class: layer-hidden
                - service: floorplan.class_set
                  service_data:
                    element: ground_floor.button
                    class: button-on
                - service: floorplan.class_set
                  service_data:
                    element: first_floor.button
                    class: button-off
                - service: floorplan.class_set
                  service_data:
                    element: attic_floor.button
                    class: button-off
            - element: first_floor.button
              tap_action:
                - service: floorplan.class_set
                  service_data:
                    elements:
                      - ground_floor
                      - garage
                    class: layer-hidden
                - service: floorplan.class_set
                  service_data:
                    element: first_floor
                    class: layer-visible
                - service: floorplan.class_set
                  service_data:
                    element: attic_floor
                    class: layer-hidden
                - service: floorplan.class_set
                  service_data:
                    element: ground_floor.button
                    class: button-off
                - service: floorplan.class_set
                  service_data:
                    element: first_floor.button
                    class: button-on
                - service: floorplan.class_set
                  service_data:
                    element: attic_floor.button
                    class: button-off
            - element: attic_floor.button
              tap_action:
                - service: floorplan.class_set
                  service_data:
                    elements:
                      - ground_floor
                      - garage
                    class: layer-hidden
                - service: floorplan.class_set
                  service_data:
                    element: first_floor
                    class: layer-hidden
                - service: floorplan.class_set
                  service_data:
                    element: attic_floor
                    class: layer-visible
                - service: floorplan.class_set
                  service_data:
                    element: ground_floor.button
                    class: button-off
                - service: floorplan.class_set
                  service_data:
                    element: first_floor.button
                    class: button-off
                - service: floorplan.class_set
                  service_data:
                    element: attic_floor.button
                    class: button-on
            - entities:
              - light.shelly_garagentor
              - entity: light.shelly_terasse
                element: light.shelly_terasse_a
              - entity: light.shelly_terasse
                element: light.shelly_terasse_b
              - light.shelly_hinterhof
              - light.shelly_gartentor
              # - light.ws2812_terrace1
              # - light.ws2812_terrace2
              - light.shelly_lounge_schwibbogen1
              - light.shelly_lounge_schwibbogen2
              - light.shelly_entrance_star
              - entity: light.shelly_entrance_drops
                element: light.shelly_entrance_drops_a
              - entity: light.shelly_entrance_drops
                element: light.shelly_entrance_drops_b
              - light.shelly_lounge_blackbowl
              - light.shelly_lounge_readinglamp
              - light.shelly_lounge_whiteball
              - light.led_corridor_led
              - light.led_kitchen_led
              - light.shelly_esszimmerschrank1
              - light.shelly_esszimmerschrank2
              - light.deckenlicht_dusche
              - light.sonoff_corridor_lamp
              - light.sonoff_gallery1_socket
              - light.deckenlicht_bad
              - light.sonoff_bedroom_socket
              - entity: light.shelly_treppe
                element: light.shelly_treppe_groundfloor
              - entity: light.shelly_treppe
                element: light.shelly_treppe_firstfloor
              - light.shelly_flur
              - light.shelly_korridor
              - light.shelly_dachboden
              - light.shelly_esszimmer1
              - light.shelly_esszimmer2_switch_0
              - light.shelly_esszimmer2_switch_1
              - light.shelly_arbeitszimmer
              - light.shelly_kinderzimmer
              - light.shelly_schlafzimmer
              - light.shelly_galerie
              - light.shelly_wohnzimmer_switch_0
              - light.shelly_wohnzimmer_switch_1
              - light.shelly_garage1
              - light.shelly_garage2
              state_action:
                - action: call-service
                  service: floorplan.class_set
                  #service_data: '${ ( entity.state === "on" ) ? "light-on" : "light-off" }'
                  service_data: light-${ entity.state }
              #tap_action:
              #  - service: light.toggle
            - entities:
              - entity: light.deckenlicht_dusche
                element: room.shower
              - entity: light.deckenlicht_bad
                element: room.bath
              - entity: light.shelly_treppe
                element: room.stairs_groundfloor
              - entity: light.shelly_treppe
                element: room.stairs_firstfloor
              - entity: light.shelly_flur
                element: room.hall
              - entity: light.shelly_korridor
                element: room.corridor
              - entity: light.shelly_dachboden
                element: room.attic
              - entity: light.shelly_arbeitszimmer
                element: room.office
              - entity: light.shelly_kinderzimmer
                element: room.nursery
              - entity: light.shelly_schlafzimmer
                element: room.bedroom
              - entity: light.shelly_galerie
                element: room.gallery
              - entity: light.shelly_wohnzimmer_switch_0
                element: room.lounge_couch
              - entity: light.shelly_wohnzimmer_switch_1
                element: room.lounge_table
              - entity: light.shelly_esszimmer1
                element: room.dining1
              - entity: light.shelly_esszimmer2_switch_0
                element: room.dining2
              - entity: light.shelly_esszimmer2_switch_1
                element: room.dining3
              - entity: light.shelly_garage1
                element: room.garage1
              - entity: light.shelly_garage2
                element: room.garage2
              state_action:
                - action: call-service
                  service: floorplan.class_set
                  service_data: roomlight-${ entity.state }
            - entities:
                - sensor.thermostat_arbeitszimmer_temperature
                - sensor.thermostat_arbeitszimmer_humidity
                - sensor.thermostat_bad_temperature
                - sensor.thermostat_bad_humidity
                - sensor.thermostat_dusche_temperature
                - sensor.thermostat_dusche_humidity
                - sensor.thermostat_esszimmer_temperature
                - sensor.thermostat_esszimmer_humidity
                - sensor.thermostat_flur_temperature
                - sensor.thermostat_flur_humidity
                - sensor.thermostat_galerie_temperature
                - sensor.thermostat_galerie_humidity
                - sensor.thermostat_hauswirtschaft_temperature
                - sensor.thermostat_hauswirtschaft_humidity
                - sensor.thermostat_kinderzimmer_temperature
                - sensor.thermostat_kinderzimmer_humidity
                - sensor.thermostat_kuche_temperature
                - sensor.thermostat_kuche_humidity
                - sensor.thermostat_schlafzimmer_temperature
                - sensor.thermostat_schlafzimmer_humidity
                - sensor.thermostat_wohnzimmer_temperature
                - sensor.thermostat_wohnzimmer_humidity
                - sensor.dht22_roof_temperature
                - sensor.dht22_roof_humidity
                - sensor.relay_garage_temperature
                - sensor.relay_garage_humidity
              state_action:
                - action: call-service
                  service: floorplan.text_set
                  service_data: ${ Math.round ( 10 * entity.state ) / 10 + " " + entity.attributes.unit_of_measurement }
              #tap_action: false
              hold_action:
                - action: call-service
                  service: floorplan.text_set
                  service_data: ${ Math.round ( 10 * entity.state ) / 10 + " " + entity.attributes.unit_of_measurement }

  - title: Strompreis
    path: epex
    panel: false
    visible: true
    cards:
      - type: custom:apexcharts-card
        # experimental:
        #   hidden_by_default: true
        graph_span: 45h
        all_series_config:
          stroke_width: 2
        span:
          start: hour
          offset: '-25h'
        now:
          show: true
        update_interval: 5min
        header:
          show: true
          title: Spotmarktpreis (€/kWh)
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.epex_spot_data_price
            yaxis_id: left
            type: line
            float_precision: 5
            name: Spot Markt
            curve: stepline
            unit: €/kWh
            show:
              in_header: false
              extremas: true
              legend_value: false
            data_generator: |
              return entity.attributes.data.map((entry) => {
                      return [new Date(entry.start_time).getTime (), entry.price_per_kwh];
                    });
          # - entity: sensor.awattar_current
          #   name: Preis
          #   yaxis_id: left
          #   type: line
          #   float_precision: 5
          #   unit: €/kWh
          #   curve: stepline
          #   extend_to: now
          #   fill_raw: last
          #   show:
          #     hidden_by_default: false
          #     legend_value: false
          # - entity: sensor.awattar_median
          #   yaxis_id: left
          #   type: line
          #   curve: stepline
          #   fill_raw: last
          #   float_precision: 5
          #   name: Median
          #   unit: €/kWh
          #   show:
          #     hidden_by_default: true
          #     legend_value: false
          # - entity: sensor.awattar_terzil2
          #   yaxis_id: left
          #   type: line
          #   curve: stepline
          #   fill_raw: last
          #   float_precision: 5
          #   name: oberstes Terzil
          #   unit: €/kWh
          #   show:
          #     hidden_by_default: false
          #     legend_value: false
          # - entity: sensor.wirkenergie
          #   curve: stepline
          #   type: area
          #   opacity: 0.3
          #   name: Bezug
          #   extend_to: now
          #   show:
          #     in_header: false
          #     legend_value: false
          #   yaxis_id: right
          #   group_by:
          #     func: delta
          #     duration: 1h
          #     fill: zero
        yaxis:
          - id: left
            decimals: 2
            min: 0
          - id: right
            opposite: true
            decimals: 2
            min: 0
            max: 10
            show: false
